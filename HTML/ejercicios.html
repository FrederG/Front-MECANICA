<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicios - Mec√°nica de Fluidos</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/ejercicio.css">
    <script defer src="/js/ejercicios.js"></script>
    <script defer src="/js/app.js"></script>
    <style>
        /* Estilos para los selectores de unidades en respuestas */
        .respuesta-contenedor {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .respuesta-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .unidad-select {
            width: 120px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }
        
        /* Estilos para ejercicios con m√∫ltiples respuestas */
        .multi-respuesta {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #1e5799;
        }
        
        .pregunta-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .pregunta-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .pregunta-texto {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="https://upload.wikimedia.org/wikipedia/commons/b/b3/Universidad_Tecnol%C3%B3gica_de_Bol%C3%ADvar.png" alt="Logo" class="logo">
            <h1>Ejercicios Interactivos</h1>
        </div>
        <nav>
            <a href="login.html">Inicio</a>
            <a href="ejercicios.html" class="active">Ejercicios</a>
            <a href="resultados.html">Resultados</a>
            <a href="login.html#Acerca">Acerca de</a>
        </nav>
        <button class="btn-logout" onclick="cerrarSesion()">Cerrar sesi√≥n</button>      
    </header>

    <main>
        <section class="contenedor-ejercicios">
            
            <h2>üíß Pr√°ctica y Evaluaci√≥n Continua</h2>
            <p>Selecciona el ejercicio y usa los botones de navegaci√≥n inferior para avanzar o retroceder.</p>
            
            <div id="puntajeUsuarioDisplay" class="score-display">Puntaje Total: 0</div>

            <div class="ejercicio card" id="ejercicio1" data-index="1">
                <h3>Ejercicio 1: Conversi√≥n de Unidades</h3>
                
                <img src="/images/ej 1.png" alt="Ejercicio 1" class="ejercicio-img">
                
                <div class="input-grupo">
                    <div class="respuesta-contenedor">
                        <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta1">
                        <select class="unidad-select" id="unidad1">
                            <option value="m">Metros (m)</option>
                            <option value="cm">Cent√≠metros (cm)</option>
                            <option value="mm">Mil√≠metros (mm)</option>
                            <option value="ft">Pies (ft)</option>
                            <option value="in">Pulgadas (in)</option>
                        </select>
                    </div>
                    <p id="puntajeDisplay1" class="puntaje-parcial">Puntaje: 0</p>
                </div>
                
                <div class="accion-grupo">
                    <button onclick="guardarYEnviar(1)" class="btn-verificar">Verificar y Guardar</button>
                    <div class="semaforo" id="semaforo1">
                        <div class="luz red"></div>
                        <div class="luz yellow"></div>
                        <div class="luz green"></div>
                    </div>
                </div>
            </div>

            <div class="ejercicio card" id="ejercicio2" data-index="2" style="display: none;">
                <h3>Ejercicio 2: Conversi√≥n de Unidades</h3>
                
                <img src="/images/ej 2.png" alt="ejercicio 2" class="ejercicio-img">
                
                <div class="input-grupo">
                    <div class="respuesta-contenedor">
                        <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta2">
                        <select class="unidad-select" id="unidad2">
                            <option value="Pa">Pascales (Pa)</option>
                            <option value="kPa">Kilopascales (kPa)</option>
                            <option value="bar">Bares (bar)</option>
                            <option value="atm">Atm√≥sferas (atm)</option>
                            <option value="psi">PSI (lb/in¬≤)</option>
                        </select>
                    </div>
                    <p id="puntajeDisplay2" class="puntaje-parcial">Puntaje: 0</p>
                </div>
                
                <div class="accion-grupo">
                    <button onclick="guardarYEnviar(2)" class="btn-verificar">Verificar y Guardar</button>
                    <div class="semaforo" id="semaforo2">
                        <div class="luz red"></div>
                        <div class="luz yellow"></div>
                        <div class="luz green"></div>
                    </div>
                </div>
            </div>

            <div class="ejercicio card" id="ejercicio3" data-index="3" style="display: none;">
                <h3>Ejercicio 3: Conversi√≥n de Unidades</h3>
                
                <img src="/images/ej 3.png" alt="ejercicio 3" class="ejercicio-img">
                
                <div class="input-grupo">
                    <div class="respuesta-contenedor">
                        <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta3">
                        <select class="unidad-select" id="unidad3">
                            <option value="N">Newtons (N)</option>
                            <option value="kN">Kilonewtons (kN)</option>
                            <option value="kgf">Kilogramos-fuerza (kgf)</option>
                            <option value="lbf">Libras-fuerza (lbf)</option>
                        </select>
                    </div>
                    <p id="puntajeDisplay3" class="puntaje-parcial">Puntaje: 0</p>
                </div>
                
                <div class="accion-grupo">
                    <button onclick="guardarYEnviar(3)" class="btn-verificar">Verificar y Guardar</button>
                    <div class="semaforo" id="semaforo3">
                        <div class="luz red"></div>
                        <div class="luz yellow"></div>
                        <div class="luz green"></div>
                    </div>
                </div>
            </div>

            <div class="ejercicio card" id="ejercicio4" data-index="4" style="display: none;">
                <h3>Ejercicio 4: Flotaci√≥n (Principio de Arqu√≠medes)</h3>
                
                <div class="enunciado-container">
                    <img src="/images/ej 4.png" alt="Ejercicio de flotaci√≥n" class="ejercicio-img-texto">
                    <p>Considere un bloque c√∫bico grande de hielo que flota en el mar. Las gravedades espec√≠ficas del hielo y del agua de mar son $0.92$ y $1.025$, respectivamente. Si una parte de $15\text{ cm}$ de alto del bloque de hielo se extiende por encima de la superficie del agua, determine la altura del bloque.</p>
                </div>

                <div class="input-grupo">
                    <div class="respuesta-contenedor">
                        <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta4">
                        <select class="unidad-select" id="unidad4">
                            <option value="cm">Cent√≠metros (cm)</option>
                            <option value="m">Metros (m)</option>
                            <option value="mm">Mil√≠metros (mm)</option>
                            <option value="ft">Pies (ft)</option>
                            <option value="in">Pulgadas (in)</option>
                        </select>
                    </div>
                    <p id="puntajeDisplay4" class="puntaje-parcial">Puntaje: 0</p>
                </div>
                
                <div class="accion-grupo">
                    <button onclick="guardarYEnviar(4)" class="btn-verificar">Verificar y Guardar</button>
                    <div class="semaforo" id="semaforo4">
                        <div class="luz red"></div>
                        <div class="luz yellow"></div>
                        <div class="luz green"></div>
                    </div>
                </div>
            </div>

            <div class="ejercicio card" id="ejercicio5" data-index="5" style="display: none;">
                <h3>Ejercicio 5: Estabilidad (Metacentro)</h3>
                
                <div class="enunciado-container">
                    <img src="/images/ej 5.png" alt="Ejercicio de estabilidad" class="ejercicio-img-texto">
                    <p>La figura 5.30 muestra una barcaza fluvial utilizada para transportar materiales a granel. Suponga que el centro de gravedad de la barcaza se encuentra en su centroide y que flota con $8.00\text{ ft}$ sumergidos. Determine el ancho m√≠nimo que garantiza su estabilidad en agua de mar.</p>
                </div>
                
                <div class="input-grupo">
                    <div class="respuesta-contenedor">
                        <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta5">
                        <select class="unidad-select" id="unidad5">
                            <option value="ft">Pies (ft)</option>
                            <option value="m">Metros (m)</option>
                            <option value="cm">Cent√≠metros (cm)</option>
                            <option value="in">Pulgadas (in)</option>
                        </select>
                    </div>
                    <p id="puntajeDisplay5" class="puntaje-parcial">Puntaje: 0</p>
                </div>

                <div class="accion-grupo">
                    <button onclick="guardarYEnviar(5)" class="btn-verificar">Verificar y Guardar</button>
                    <div class="semaforo" id="semaforo5">
                        <div class="luz red"></div>
                        <div class="luz yellow"></div>
                        <div class="luz green"></div>
                    </div>
                </div>
            </div>

            <!-- EJERCICIO CON M√öLTIPLES RESPUESTAS -->
            <div class="ejercicio card" id="ejercicio6" data-index="6" style="display: none;">
                <h3>Ejercicio 6</h3>
                
                <div class="enunciado-container">
                    <img src="/images/ej 6.png" alt="Ejercicio de tuber√≠as" class="ejercicio-img-texto">
                    <p></p>
                </div>

                <div class="multi-respuesta">
                    <div class="pregunta-item">
                        <div class="pregunta-texto">a) Y cb</div>
                        <div class="respuesta-contenedor">
                            <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta6a">
                            <select class="unidad-select" id="unidad6a">
                                <option value="m/s">m/s</option>
                                <option value="cm/s">cm/s</option>
                                <option value="ft/s">ft/s</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="pregunta-item">
                        <div class="pregunta-texto">b) Centro de flotabilidad (consideramos la parte sumergida)</div>
                        <div class="respuesta-contenedor">
                            <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta6b">
                            <select class="unidad-select" id="unidad6b">
                                <option value="m">Metros (m)</option>
                                <option value="cm">Cent√≠metros (cm)</option>
                                <option value="ft">Pies (ft)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="pregunta-item">
                        <div class="pregunta-texto">c) Distancia al metacentro desde el centro de flotabilidad</div>
                        <div class="respuesta-contenedor">
                            <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta6c">
                            <select class="unidad-select" id="unidad6c">
                                <option value="ft">Pies (ft)</option>
                                <option value="m">Metros (m)</option>
                                <option value="cm">Cent√≠metros (cm)</option>
                                <option value="in">Pulgadas (in)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="pregunta-item">
                        <div class="pregunta-texto">d) Posicion del metacentro</div>
                        <div class="respuesta-contenedor">
                            <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta6d">
                            <select class="unidad-select" id="unidad6d">
                                <option value="ft">Pies (ft)</option>
                                <option value="m">Metros (m)</option>
                                <option value="cm">Cent√≠metros (cm)</option>
                                <option value="in">Pulgadas (in)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <p id="puntajeDisplay6" class="puntaje-parcial">Puntaje: 0</p>

                <div class="accion-grupo">
                    <button onclick="guardarYEnviarMultiples(6)" class="btn-verificar">Verificar y Guardar</button>
                    <div class="semaforo" id="semaforo6">
                        <div class="luz red"></div>
                        <div class="luz yellow"></div>
                        <div class="luz green"></div>
                    </div>
                </div>
            </div>

            <!-- EJERCICIOS 7-9 NORMALES -->
            <div class="ejercicio card" id="ejercicio7" data-index="7" style="display: none;">
                <h3>Ejercicio 7: Presi√≥n Hidrost√°tica</h3>
                
                <div class="enunciado-container">
                    <img src="/images/ej 7.png" alt="Ejercicio de presi√≥n hidrost√°tica" class="ejercicio-img-texto">
                    <p></p>
                </div>

                <div class="input-grupo">
                    <div class="respuesta-contenedor">
                        <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta7">
                        <select class="unidad-select" id="unidad7">
                            <option value="ft">Pies (ft)</option>
                            <option value="m">Metros (m)</option>
                            <option value="cm">Cent√≠metros (cm)</option>
                            <option value="in">Pulgadas (in)</option>
                        </select>
                    </div>
                    <p id="puntajeDisplay7" class="puntaje-parcial">Puntaje: 0</p>
                </div>
                
                <div class="accion-grupo">
                    <button onclick="guardarYEnviar(7)" class="btn-verificar">Verificar y Guardar</button>
                    <div class="semaforo" id="semaforo7">
                        <div class="luz red"></div>
                        <div class="luz yellow"></div>
                        <div class="luz green"></div>
                    </div>
                </div>
            </div>

            <div class="ejercicio card" id="ejercicio8" data-index="8" style="display: none;">
                <h3>Ejercicio 8: Densidad del Iceberg</h3>
                
                <div class="enunciado-container">
                    <img src="/images/ej 8.png" alt="Ejercicio de densidad del iceberg" class="ejercicio-img-texto">
                    <p>Se estima que 90% del volumen de un iceberg est√° debajo de la superficie, mientras que s√≥lo es visible 10 % arriba de la superficie. Para agua de mar con una densidad de 1 025 kg/m¬≥, estime la densidad del iceberg.</p>
                </div>

                <div class="input-grupo">
                    <div class="respuesta-contenedor">
                        <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta8">
                        <select class="unidad-select" id="unidad8">
                            <option value="kg/m3">kg/m¬≥</option>
                            <option value="g/cm3">g/cm¬≥</option>
                            <option value="lb/ft3">lb/ft¬≥</option>
                            <option value="slug/ft3">slug/ft¬≥</option>
                        </select>
                    </div>
                    <p id="puntajeDisplay8" class="puntaje-parcial">Puntaje: 0</p>
                </div>
                
                <div class="accion-grupo">
                    <button onclick="guardarYEnviar(8)" class="btn-verificar">Verificar y Guardar</button>
                    <div class="semaforo" id="semaforo8">
                        <div class="luz red"></div>
                        <div class="luz yellow"></div>
                        <div class="luz green"></div>
                    </div>
                </div>
            </div>

            <div class="ejercicio card" id="ejercicio9" data-index="9" style="display: none;">
                <h3>Ejercicio 9: Espesor de Lat√≥n para Flotabilidad Neutra</h3>
                
                <div class="enunciado-container">
                    <img src="/images/ej 9.png" alt="Ejercicio de espesor de lat√≥n" class="ejercicio-img-texto">
                    <p>Una pesa de lat√≥n se unir√° a la parte inferior del cilindro descrito en los problemas 5.22 y 5.23, de modo que est√© completamente sumergido y tenga flotabilidad neutra en agua a 95 ¬∞C. El lat√≥n debe tener la forma de un cilindro con el mismo di√°metro que el cilindro original mostrado en la figura 5.24. ¬øCu√°l es el espesor requerido para el lat√≥n?</p>
                </div>

                <div class="input-grupo">
                    <div class="respuesta-contenedor">
                        <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta9">
                        <select class="unidad-select" id="unidad9">
                            <option value="mm">Mil√≠metros (mm)</option>
                            <option value="cm">Cent√≠metros (cm)</option>
                            <option value="m">Metros (m)</option>
                            <option value="in">Pulgadas (in)</option>
                            <option value="ft">Pies (ft)</option>
                        </select>
                    </div>
                    <p id="puntajeDisplay9" class="puntaje-parcial">Puntaje: 0</p>
                </div>
                
                <div class="accion-grupo">
                    <button onclick="guardarYEnviar(9)" class="btn-verificar">Verificar y Guardar</button>
                    <div class="semaforo" id="semaforo9">
                        <div class="luz red"></div>
                        <div class="luz yellow"></div>
                        <div class="luz green"></div>
                    </div>
                </div>
            </div>

            <!-- EJERCICIO 10 CON M√öLTIPLES RESPUESTAS -->
            <div class="ejercicio card" id="ejercicio10" data-index="10" style="display: none;">
                <h3>Ejercicio 10: Estabilidad de Plataforma</h3>
                
                <div class="enunciado-container">
                    <img src="/images/ej 10.png" alt="Ejercicio de estabilidad de plataforma" class="ejercicio-img-texto">
                    <p>Se est√° dise√±ando una plataforma para soportar un equipo de control de la contaminaci√≥n del agua. Como se muestra en la figura 5.31, su base es de 36.00 in de ancho por 48.00 in de largo y 12.00 in de alto. El sistema completo pesa 130 lb y su centro de gravedad est√° a 34.0 in por encima de la superficie superior de la plataforma. ¬øEl sistema propuesto ser√° estable cuando flote en agua de mar?</p>
                </div>

                <div class="multi-respuesta">
                    <div class="pregunta-item">
                        <div class="pregunta-texto">a) BM</div>
                        <div class="respuesta-contenedor">
                            <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta10a">
                            <select class="unidad-select" id="unidad10a">
                                <option value="in">Pulgadas (in)</option>
                                <option value="cm">Cent√≠metros (cm)</option>
                                <option value="m">Metros (m)</option>
                                <option value="ft">Pies (ft)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="pregunta-item">
                        <div class="pregunta-texto">b) KM</div>
                        <div class="respuesta-contenedor">
                            <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta10b">
                            <select class="unidad-select" id="unidad10b">
                                <option value="in">Pulgadas (in)</option>
                                <option value="cm">Cent√≠metros (cm)</option>
                                <option value="m">Metros (m)</option>
                                <option value="ft">Pies (ft)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="pregunta-item">
                        <div class="pregunta-texto">c) KG</div>
                        <div class="respuesta-contenedor">
                            <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta10c">
                            <select class="unidad-select" id="unidad10c">
                                <option value="in">Pulgadas (in)</option>
                                <option value="cm">Cent√≠metros (cm)</option>
                                <option value="m">Metros (m)</option>
                                <option value="ft">Pies (ft)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="pregunta-item">
                        <div class="pregunta-texto">d)KB</div>
                        <div class="respuesta-contenedor">
                            <input type="number" placeholder="Respuesta" class="respuesta-input" id="respuesta10d" min="0" max="1" step="1">
                            <select class="unidad-select" id="unidad10d" disabled>
                                <option value="adimensional">Adimensional</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <p id="puntajeDisplay10" class="puntaje-parcial">Puntaje: 0</p>

                <div class="accion-grupo">
                    <button onclick="guardarYEnviarMultiples(10)" class="btn-verificar">Verificar y Guardar</button>
                    <div class="semaforo" id="semaforo10">
                        <div class="luz red"></div>
                        <div class="luz yellow"></div>
                        <div class="luz green"></div>
                    </div>
                </div>
            </div>

            <div class="nav-ejercicios">
                <button id="btnAnterior" class="btn-nav">‚¨Ö Anterior</button>
                <span id="contador">Ejercicio 1 de 10</span>
                <button id="btnSiguiente" class="btn-nav">Siguiente ‚Æï</button>
            </div>

        </section>
    </main>

    <script>
        let lastScroll = 0;  // almacena la posici√≥n anterior del scroll
        const header = document.querySelector("header");

        window.addEventListener("scroll", () => {
            const currentScroll = window.pageYOffset;

            // si bajamos, escondemos el header
            if (currentScroll > lastScroll && currentScroll > 100) {
                header.style.top = "-100px";  // mu√©velo fuera de la vista
            } 
            // si subimos, mostramos el header
            else {
                header.style.top = "0";
            } 

            lastScroll = currentScroll;
        });

        // Este c√≥digo debe estar en tu archivo /js/app.js o /js/login.js
        function cerrarSesion() {
            // 1. Opcional: Eliminar el estado de sesi√≥n (como el usuario guardado)
            localStorage.removeItem("usuarioActivo");

            // 2. Redirigir al archivo ../index.html
            window.location.href = "../index.html"; 
        }
    </script>

    <section>
        <script>
            console.log("‚úÖ Script de ejercicios cargado correctamente");

            // --- Control de ejercicios visibles ---
            let ejercicioActual = 0;
            const ejercicios = document.querySelectorAll(".ejercicio");
            const Anterior = document.getElementById("btnAnterior");
            const Siguiente = document.getElementById("btnSiguiente");
            const contador = document.getElementById("contador");

            function mostrarEjercicio(index) {
                ejercicios.forEach((ej, i) => {
                    ej.style.display = i === index ? "block" : "none";
                });

                contador.textContent = `Ejercicio ${index + 1} de ${ejercicios.length}`;
                Anterior.disabled = index === 0;
                Siguiente.disabled = index === ejercicios.length - 1;
            }

            Anterior.addEventListener("click", () => {
                if (ejercicioActual > 0) {
                    ejercicioActual--;
                    mostrarEjercicio(ejercicioActual);
                }
            });

            Siguiente.addEventListener("click", () => {
                if (ejercicioActual < ejercicios.length - 1) {
                    ejercicioActual++;
                    mostrarEjercicio(ejercicioActual);
                }
            });

            if (ejercicios.length > 0) mostrarEjercicio(ejercicioActual);

            // ----------------------------------------------------------------------
            // PUNTAJE TOTAL
            // ----------------------------------------------------------------------
            async function actualizarPuntajeTotal() {
                obtenerPuntajeDesdeServidor();
            }

            // ----------------------------------------------------------------------
            // ENVIAR RESULTADO (EJERCICIOS SIMPLES)
            // ----------------------------------------------------------------------
            async function guardarYEnviar(numEjercicio) {
                const usuario = localStorage.getItem("usuarioActivo");
                if (!usuario) return alert("Debes iniciar sesi√≥n.");

                const input = document.querySelector(`#ejercicio${numEjercicio} input`);
                const valor = input.value || "0";

                try {
                    const response = await fetch("https://backend-fluidos-production.up.railway.app/guardar_resultado/", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            usuario,
                            ejercicio: numEjercicio,
                            respuesta: valor,
                        }),
                    });

                    const resultado = await response.json();
                    console.log("üì° Servidor respondi√≥:", resultado);

                    const { color, puntaje } = resultado;

                    // Actualizar visualmente
                    const display = document.getElementById(`puntajeDisplay${numEjercicio}`);
                    if (display) display.textContent = `Puntaje: ${puntaje}`;

                    const semaforo = document.querySelector(`#semaforo${numEjercicio}`);
                    if (semaforo) {
                        semaforo.querySelectorAll(".luz").forEach(l => l.classList.remove("on"));
                        semaforo.querySelector(`.${color}`).classList.add("on");
                    }

                    alert(
                        color === "green"
                            ? "‚úÖ ¬°Correcto!"
                            : color === "yellow"
                            ? "üü° Casi correcto"
                            : "‚ùå Incorrecto"
                    );

                    actualizarPuntajeTotal();
                } catch (error) {
                    console.error("‚ùå Error al enviar resultado:", error);
                    alert("Error al conectar con el servidor.");
                }
            }

            // ----------------------------------------------------------------------
            // ENVIAR EJERCICIO M√öLTIPLE
            // ----------------------------------------------------------------------
            async function guardarYEnviarMultiples(numEjercicio) {
                const usuario = localStorage.getItem("usuarioActivo");
                if (!usuario) return alert("Debes iniciar sesi√≥n.");

                const respuestas = obtenerRespuestasMultiples(numEjercicio);

                try {
                    const response = await fetch("https://backend-fluidos-production.up.railway.app/guardar_resultado/", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            usuario,
                            ejercicio: numEjercicio,
                            respuesta: JSON.stringify(respuestas),
                        }),
                    });

                    const resultado = await response.json();

                    const { color, puntaje } = resultado;

                    const display = document.getElementById(`puntajeDisplay${numEjercicio}`);
                    if (display) display.textContent = `Puntaje: ${puntaje}`;

                    const semaforo = document.querySelector(`#semaforo${numEjercicio}`);
                    if (semaforo) {
                        semaforo.querySelectorAll(".luz").forEach(l => l.classList.remove("on"));
                        semaforo.querySelector(`.${color}`).classList.add("on");
                    }

                    alert(
                        color === "green"
                            ? "‚úÖ ¬°Correcto!"
                            : color === "yellow"
                            ? "üü° Casi correcto"
                            : "‚ùå Incorrecto"
                    );

                    actualizarPuntajeTotal();
                } catch (error) {
                    alert("Error al conectar con el servidor.");
                }
            }

            // ----------------------------------------------------------------------
            // OBTENER RESPUESTAS
            // ----------------------------------------------------------------------
            function obtenerRespuestasMultiples(numEjercicio) {
                return {
                    a: {
                        valor: document.getElementById(`respuesta${numEjercicio}a`).value,
                        unidad: document.getElementById(`unidad${numEjercicio}a`).value,
                    },
                    b: {
                        valor: document.getElementById(`respuesta${numEjercicio}b`).value,
                        unidad: document.getElementById(`unidad${numEjercicio}b`).value,
                    },
                    c: {
                        valor: document.getElementById(`respuesta${numEjercicio}c`).value,
                        unidad: document.getElementById(`unidad${numEjercicio}c`).value,
                    },
                    d: {
                        valor: document.getElementById(`respuesta${numEjercicio}d`).value,
                        unidad: document.getElementById(`unidad${numEjercicio}d`).value,
                    },
                };
            }

            // --------------------------------------------------------------
            // PUNTAJE TOTAL DESDE EL SERVIDOR
            // --------------------------------------------------------------
            async function obtenerPuntajeDesdeServidor() {
                const usuario = localStorage.getItem("usuarioActivo");
                if (!usuario) return;

                try {
                    const res = await fetch(`https://backend-fluidos-production.up.railway.app/puntaje_total/${usuario}`);
                    const data = await res.json();

                    const totalDisplay = document.getElementById("puntajeUsuarioDisplay");
                    if (totalDisplay) {
                        totalDisplay.textContent = `Puntaje total: ${data.puntaje_total}`;
                    }
                } catch (error) {
                    console.error("‚ùå Error al obtener puntaje:", error);
                }
            }

            window.addEventListener("load", obtenerPuntajeDesdeServidor);
        </script>
    </section>
</body>
</html>